<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vue Chat with Video</title>
    <!-- Vue 3 CDN -->
    <script src="https://unpkg.com/vue@3"></script>
    <!-- Socket.IO Client -->
    <script src="https://cdn.socket.io/4.5.3/socket.io.min.js"></script>
    <!-- YouTube IFrame API -->
    <script src="https://www.youtube.com/iframe_api"></script>

    <link rel="stylesheet" href="{{ url_for('static', filename='css/chat.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/menu.css') }}">
    <script src="{{ url_for('static', filename='js/menu.js') }}" defer></script>
    <script src="{{ url_for('static', filename='js/chat.js') }}" defer></script>
    <link href="https://fonts.googleapis.com/css2?family=Gugi&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Chewy&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;700&display=swap" rel="stylesheet">
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-7311759917249115"
    crossorigin="anonymous"></script>

</head>
<body>
<div id="menu">
  {% include "menu.html" %}
</div>

<div id="app">
  <!-- ë‹‰ë„¤ì„ ì„¤ì • í™”ë©´ -->
  <div v-if="!isUsernameSet" class="username-setup">
    <div class="form-container">
      <div class="logo-container">ë‹‰ë„¤ì„ì„ ì„¤ì •í•´ì£¼ì„¸ìš”</div>
      <form class="form">
        <div class="form-group">
          
      <input type="text" v-model="username" @keydown.enter="confirmUsername" placeholder="ë‹‰ë„¤ì„ì„ ì…ë ¥í•˜ì„¸ìš”" maxlength="10">
      </div>
      <button type="submit" @click="confirmUsername" class="form-submit-btn">í™•ì¸</button>
      
    </form>
    </div>
  </div>
  
  <!-- ë©”ì¸ ë ˆì´ì•„ì›ƒ -->
  <div v-else class="main-container">
    <!-- ìƒë‹¨ ë°”: ì‚¬ìš©ì ëª©ë¡ í† ê¸€ ë²„íŠ¼ -->
    <div class="top-bar">
      <button class="toggle-user-list-btn" @click="toggleUserList">
        <img src="/static/image/user.png" alt="user-icon" class="user-icon">
      </button>
      <button class="exit-btn" @click="exitApp">
        <img src="/static/image/exit.png" alt="exit-icon" class="exit-icon">
      </button>
    </div>

    <!-- ì‚¬ìš©ì ëª©ë¡ íŒ¨ë„ -->
    <div class="left-panel" :class="{ open: isMenuOpen }">
      <div class="user-list-area">
        <p class="user-list-title">ì‚¬ìš©ì ëª©ë¡</p>
        <ul>
          {% raw %}
          <li v-for="(user, index) in users" :key="index">{{ user }}</li>
          {% endraw %}
        </ul>
      </div>
    </div>

    <!-- ë©”ì¸ ì»¨í…ì¸  ì˜ì—­ -->
    <div class="main-content">
      <!-- ë¹„ë””ì˜¤ & ê²€ìƒ‰ ì˜ì—­ -->
      <div class="video-search-section">
        <!-- ë¹„ë””ì˜¤ ì˜ì—­ (ì™¼ìª½) -->
        <div class="video-area">
          <div id="player"></div>
          <div class="video-controls">
            <button @click="playVideo">ì¬ìƒ</button>
            <button @click="pauseVideo">ì¼ì‹œì •ì§€</button>
          </div>
        </div>
        
        <!-- ê²€ìƒ‰ ì˜ì—­ (ì˜¤ë¥¸ìª½) -->
        <div class="search-area">
          <div class="search-input-group">
              <input class="search-input" type="text" v-model="searchInput" @keydown.enter="search" placeholder="ê²€ìƒ‰ì–´ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
              <button @click="search" class="search-button">ê²€ìƒ‰</button>
          </div>

          <div v-if="isLoading" class="spinner">
              <div class="loader"></div>
              <p>ê²€ìƒ‰ ì¤‘...</p>
          </div>

          <div v-else>
              <div v-if="videoResults.length > 0" class="results">
                  <p class="results-title">ê²€ìƒ‰ ê²°ê³¼</p>
                  <!-- ê²€ìƒ‰ ê²°ê³¼ ë¦¬ìŠ¤íŠ¸ -->
                  <ul class="video-list">
                    {% raw %}
                    <li v-for="(video_detail, index) in videoResults.slice(0,10)" :key="index" class="video-item">
                      <!-- ì˜ìƒ í´ë¦­ ì‹œ selectVideo ë©”ì„œë“œ í˜¸ì¶œ -->
                      <a href="#" @click.prevent="selectVideo(video_detail.video_id)" class="video-link">
                        <img 
                          :src="video_detail.thumbnail_url" 
                          :alt="video_detail.title"
                          class="video-thumbnail"
                        />
                      </a>
                      <div class="video-info">
                        <p class="video-title">{{ truncatedTitle(video_detail.title, 20) }}</p>
                        <p class="video-meta">ê¸¸ì´: {{ video_detail.duration }} | ë“±ë¡ì¼: {{ video_detail.published_at }}</p>
                        <p class="video-meta">ì¡°íšŒ: {{ video_detail.view_count }} | ì¢‹ì•„ìš”: {{ video_detail.like_count }}</p>
                        <p class="video-meta">ìë§‰: {{ video_detail.captions_info }}</p>
                      </div>
                      
                    </li>
                    {% endraw %}
                  </ul>
                </div>            
              <div v-else class="no-results">
                  <p>ê²€ìƒ‰ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
              </div>
          </div>
        </div>
      </div>

      <!-- ì±„íŒ… ì˜ì—­ (ê³ ì • ë†’ì´) -->
      <div class="chat-area">
        <div id="chatMessages" ref="chatMessages" class="chat-messages">
          {% raw %}
          <div 
            v-for="(msg, index) in messages" 
            :key="index" 
            :class="['message', msg.isMe ? 'my-message' : '']">
            
            <!-- "ë‚˜"ì¼ ë•Œì™€ ì•„ë‹ ë•Œ ì¡°ê±´ì ìœ¼ë¡œ ë Œë”ë§ -->
            <div class="sender">
              <span v-if="msg.isMe">{{ msg.sender }}(ë‚˜)</span>
              <span v-else>{{ msg.sender }} </span>
            </div>
            
            <div class="text" v-html="msg.text">{{ msg.text }}</div>
          </div>
          {% endraw %}
        </div>
        
        <div class="input-area">
          <!-- <input v-model="newMessage" @keydown.enter="sendMessage"  placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"> -->
        <div
          id="messageInput" 
          class="editable-input" 
          contenteditable="true" 
          placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”"
          ref="messageInput"
          @keydown.enter.prevent="sendMessage">
        </div>
          <button @click="sendMessage">ì „ì†¡</button>
          <button @click="toggleEmojiPanel" class="emoji-toggle-btn">ğŸ˜Š</button>
        </div>

        <div v-if="isEmojiPanelVisible" class="emoji-panel">
          <div v-for="(emoji, index) in emojis" 
              :key="index" 
              class="emoji" 
              @click="addEmojiToInput(emoji.src)"
              @keydown.enter="sendMessage">
            <img :src="emoji.src" :alt="emoji.name" class="emoji-img">
          </div>
        </div>

      </div>
    </div>
  </div>
</div>
</body>
</html>
